<div class="products" fxFlex fxLayout="column" fxLayoutGap="20px">
  <div *ngIf="!isRightNavOpen && productPillsArray" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
    <div class="img-box">
      <img [src]="svgPath + 'doc-icon-blue.svg'" />
    </div>
    <h2>Products</h2>
  </div>
  <div class="cp-container" fxLayout="column">
    <p *ngIf="productPillsArray && productPillsArray.length > 0">Select the product to select the related terms that you want to inspect</p>
    <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="15px">
      <ng-container *ngFor="let product of productPillsArray; let i = index;">
        <il-pill [state]="state" (stateEmitter)="removeSelection()" (click)="OnEditProduct(product)" [enabled]="!isRightNavOpen" [item]="{label: product.name}" [enableHighlight]="true" (removeEmitter)="onRemoveProduct(product)" [selectable]="true">
        </il-pill>
        <il-pill size="small" [enabled]="isRightNavOpen" *ngFor="let sub of product.subProducts; let i = index;" [item]="{label: sub.name}" [enableHighlight]="true" (removeEmitter)="onRemoveSubProduct(product, sub, $event)" [selectable]="true">
        </il-pill>
      </ng-container>
    </div>

    <!-- product with/without set -->
    <div *ngIf="!isRightNavOpen" class="product-section" fxLayout="row" [formGroup]="form" fxLayoutGap="20px">
      <div fxFlex fxLayout="column" fxLayoutAlign="start start">
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="20px">
          <il-input-select fxFlex [form]="form" [controlName]="'name'" [isReadOnly]="isRightNavOpen"></il-input-select>
          <il-input fxFlex="15" [form]="form" [isNumberOnly]="true" [controlName]="'qty'" placeholder="Enter quantity" [isReadOnly]="isRightNavOpen"></il-input>
          <il-input fxFlex="15" [form]="form" [isNumberOnly]="true" [controlName]="'cost'" [showErrors]="hasSubProducts" placeholder="Enter unit cost"></il-input>
          <div fxFlex="5"></div>
        </div>
        <ng-container *ngIf="hasSubProducts">
          <div *ngFor="let subProducts of form.get('subProducts')?.controls; let i = index" fxLayout="column">
            <ng-container formArrayName="subProducts">
              <div fxFlex fxLayoutGap="20px" [formGroupName]="i" fxLayout="row" fxLayoutAlign="start center">
                <il-input-select [isRequired]="hasSubProducts" [form]="subProducts" [controlName]="'name'" fxFlex fxFlexOffset="20px">
                </il-input-select>
                <il-input fxFlex="15" [form]="subProducts" [isNumberOnly]="true" [controlName]="'qty'" placeholder="Enter quantity"></il-input>
                <il-input fxFlex="15" [form]="subProducts" [isNumberOnly]="true" [controlName]="'cost'" placeholder="Enter unit cost"></il-input>
                <div fxFlex="5" fxLayoutAlign="start center">
                  <img class="remove-icon" (click)="onRemoveSubProduct(i)" [src]="svgPath + 'delete-icon-red.svg'">
                </div>
              </div>
            </ng-container>
          </div>
        </ng-container>
      </div>

      <div fxFlex="20" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="20px">
        <button [disabled]="!form.valid" *ngIf="!isEditProduct" mat-flat-button class="il-button primary" (click)="addProductToPills()">
          Add Product
        </button>
        <button *ngIf="isEditProduct" mat-flat-button class="il-button primary" (click)="onEditProductSave()">
          Save Product
        </button>
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
          <mat-checkbox [checked]="hasSubProducts" [disabled]="!form.valid" (change)="onShowSubProduct()"></mat-checkbox>
          <img *ngIf="subProductsArray && hasSubProducts" (click)="onAddSubProduct()" class="add-icon" [src]="svgPath + 'add-icon-blue.svg'">
        </div>
      </div>
    </div>
  </div>
</div>
