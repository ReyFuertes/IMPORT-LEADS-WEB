<div class="products" fxFlex fxLayout="column" fxLayoutGap="20px">
  <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
    <div class="img-box">
      <img [src]="svgPath + 'doc-icon-blue.svg'" />
    </div>
    <h2>Products</h2>
  </div>
  <div fxLayout="column">
    <div fxLayout="row wrap" fxLayoutAlign="start center" fxLayoutGap="20px">
      <il-pill *ngFor="let product of formProducts?.get('products')?.controls; let i = index;" [item]="product?.value" [enableHighlight]="true" (removeEmitter)="onRemove($event)" [selectable]="true">
      </il-pill>
      <il-pill *ngFor="let subProducts of formProducts.get('productSubProducts')?.controls; let i = index" [item]="subProducts?.value" [enableHighlight]="true" (removeEmitter)="onRemove($event)" [selectable]="true">
      </il-pill>
    </div>

    <!-- product without set -->
    <div [formGroup]="form" fxLayoutGap="20px">
      <ng-container *ngIf="!hasSubProducts; else WithSubProduct">
        <div fxFlex fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="20px">
          <il-input-select fxFlex [form]="form" [controlName]="'name'" [isReadOnly]="isRightNavOpen"></il-input-select>
          <il-input fxFlex="15" [form]="form" [isNumberOnly]="true" [controlName]="'qty'" placeholder="Enter quantity" [isReadOnly]="isRightNavOpen"></il-input>
          <il-input fxFlex="15" [form]="form" [isNumberOnly]="true" [controlName]="'cost'" [showErrors]="true" placeholder="Enter unit cost"></il-input>
        </div>
      </ng-container>

      <div fxFlex="20" fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="20px">
        <button [disabled]="!form.valid" mat-flat-button class="il-button primary" (click)="addProductToPills()">
          Add Product
        </button>
        <div fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="10px">
          <mat-checkbox [disabled]="!form.valid" (change)="onShowSubProduct()"></mat-checkbox>
          <img *ngIf="subProductsArray" (click)="onAddSubProduct()" class="add-sub-product" [src]="svgPath + 'add-icon-blue.svg'">
        </div>
      </div>
    </div>
    <!-- product with set -->
    <!-- <il-contract-detail-product-set></il-contract-detail-product-set> -->

    <!-- <div *ngIf="subProductsArray" [formGroup]="formSubProducts" class="sub-product">
      <div *ngFor="let subProducts of formSubProducts.get('subProducts')['controls']; let i = index">
        <ng-container formArrayName="subProducts">
          <div fxFlex fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="20px" [formGroupName]="i">
            <il-input-select fxFlex="33" fxFlexOffset="20px" [form]="subProducts" [controlName]="'name'"></il-input-select>
            <il-input fxFlex="15" [form]="subProducts" [isNumberOnly]="true" [controlName]="'qty'" placeholder="Enter quantity"></il-input>
            <il-input fxFlex="15" [form]="subProducts" [isNumberOnly]="true" [controlName]="'cost'" placeholder="Enter unit cost"></il-input>
            <div>
              <img (click)="onRemoveSubProduct(i)" [src]="svgPath + 'delete-icon-red.svg'">
            </div>
          </div>
        </ng-container>
      </div>
    </div> -->
  </div>
</div>

<ng-template #WithSubProduct>
  <div fxFlex fxLayout="row" fxLayoutAlign="start center" fxLayoutGap="20px">
    <il-input-select fxFlex [form]="form" [controlName]="'name'" [isReadOnly]="isRightNavOpen"></il-input-select>
    <il-input fxFlex="15" [form]="form" [isNumberOnly]="true" [controlName]="'qty'" placeholder="Enter quantity" [isReadOnly]="isRightNavOpen"></il-input>
    <il-input fxFlex="15" [form]="form" [isNumberOnly]="true" [controlName]="'cost'" [showErrors]="true" placeholder="Enter unit cost"></il-input>
  </div>
  <div *ngFor="let subProducts of formProducts.get('subProducts')?.controls; let i = index" fxLayout="column">
    <ng-container formArrayName="subProducts">
      <div fxFlex fxLayoutGap="20px" [formGroupName]="i" fxLayout="row" fxLayoutAlign="start center">
        <il-input-select [form]="subProducts" [controlName]="'name'" fxFlex="33" fxFlexOffset="20px"></il-input-select>
        <il-input fxFlex="15" [form]="subProducts" [isNumberOnly]="true" [controlName]="'qty'" placeholder="Enter quantity"></il-input>
        <il-input fxFlex="15" [form]="subProducts" [isNumberOnly]="true" [controlName]="'cost'" placeholder="Enter unit cost"></il-input>
        <div>
          <img (click)="onRemoveSubProduct(i)" [src]="svgPath + 'delete-icon-red.svg'">
        </div>
      </div>
    </ng-container>
  </div>
</ng-template>
